<!--pages/record-detail/record-detail.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <view class="error-text">{{error}}</view>
    <button class="retry-btn" bindtap="loadRecordDetail">é‡è¯•</button>
  </view>

  <!-- è®°å½•è¯¦æƒ…å†…å®¹ -->
  <view wx:else class="record-detail">
    <!-- 1. è®°å½•å†…å®¹ -->
    <view class="content-section">
      <view class="section-title">è®°å½•å†…å®¹</view>
      <view class="content-text">{{record.content}}</view>
    </view>

    <!-- 2. æ‰€å±ç›®æ ‡ -->
    <view class="goal-section" wx:if="{{record.goal_id}}">
      <view class="section-title">æ‰€å±ç›®æ ‡</view>
      <view class="goal-card" bindtap="goToGoalDetail">
        <view class="goal-info">
          <text class="goal-title">{{associatedGoal.title || 'åŠ è½½ä¸­...'}}</text>
          <text class="goal-category" wx:if="{{associatedGoal.category}}">{{associatedGoal.category}}</text>
        </view>
        <view class="goal-arrow">></view>
      </view>
    </view>

    <!-- 3. è®°å½•ç±»å‹ -->
    <view class="record-type-section">
      <view class="section-title">è®°å½•ç±»å‹</view>
      <view class="type-display">
        <text class="type-icon">{{recordTypeIcon}}</text>
        <text class="type-name">{{recordTypeName}}</text>
      </view>
    </view>

    <!-- 4. è®°å½•æ ‡ç­¾ -->
    <view class="tags-section" wx:if="{{record.tags && record.tags.length > 0}}">
      <view class="section-title">æ ‡ç­¾</view>
      <view class="tags-container">
        <view class="tag" wx:for="{{record.tags}}" wx:key="*this">{{item}}</view>
      </view>
    </view>

    <!-- 5. é‡è¦æ ‡è®° -->
    <view class="flags-section" wx:if="{{record.is_important || record.is_milestone || record.is_breakthrough}}">
      <view class="section-title">é‡è¦æ ‡è®°</view>
      <view class="flags-container">
        <view class="flag important" wx:if="{{record.is_important}}">â­ é‡è¦</view>
        <view class="flag milestone" wx:if="{{record.is_milestone}}">ğŸ† é‡Œç¨‹ç¢‘</view>
        <view class="flag breakthrough" wx:if="{{record.is_breakthrough}}">ğŸ’¡ çªç ´</view>
      </view>
    </view>

    <!-- 6. é™„ä»¶ -->
    <view class="attachments-section" wx:if="{{record.attachments}}">
      <view class="section-title">é™„ä»¶</view>
      
      <!-- è¯­éŸ³é™„ä»¶ -->
      <view class="attachment-item" wx:if="{{record.attachments.audio}}">
        <view class="attachment-icon">ğŸµ</view>
        <view class="attachment-info">
          <text class="attachment-name">è¯­éŸ³æ–‡ä»¶</text>
          <text class="attachment-duration" wx:if="{{record.attachments.duration}}">{{record.attachments.duration}}ç§’</text>
        </view>
        <button class="play-btn" bindtap="playVoiceAttachment" data-url="{{record.attachments.audio}}">æ’­æ”¾</button>
      </view>
      
      <!-- å›¾ç‰‡é™„ä»¶ -->
      <view class="attachment-item" wx:if="{{record.attachments.image}}">
        <view class="attachment-icon">ğŸ–¼ï¸</view>
        <view class="attachment-info">
          <text class="attachment-name">å›¾ç‰‡æ–‡ä»¶</text>
          <text class="attachment-size" wx:if="{{record.attachments.size}}">{{record.attachments.size}}</text>
        </view>
        <button class="preview-btn" bindtap="previewImage" data-url="{{record.attachments.image}}">é¢„è§ˆ</button>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions-section">
      <button class="action-btn edit-btn" bindtap="editRecord">ç¼–è¾‘</button>
      <button class="action-btn delete-btn" bindtap="deleteRecord">åˆ é™¤</button>
    </view>
  </view>
</view>
