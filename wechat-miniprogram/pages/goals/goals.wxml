<!-- ç›®æ ‡ç®¡ç†é¡µé¢ -->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="header">
    <text class="page-title">ç›®æ ‡ç®¡ç†</text>
    <view class="header-actions">
      <view class="action-btn" bindtap="toggleSearchBar">
        <text class="action-icon">ğŸ”</text>
      </view>
      <view class="action-btn" bindtap="showFilterOptions">
        <text class="action-icon">âš™ï¸</text>
      </view>
      <view class="create-btn" bindtap="showCreateModal">
        <text class="create-icon">â•</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-bar" wx:if="{{showSearchBar}}">
    <input class="search-input" 
           placeholder="æœç´¢ç›®æ ‡æ ‡é¢˜æˆ–ç±»åˆ«..." 
           value="{{searchText}}"
           bindinput="onSearchInput" />
  </view>

  <!-- ç›®æ ‡ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="goals-overview">
    <view class="overview-item">
      <text class="overview-number">{{totalGoals}}</text>
      <text class="overview-label">æ€»ç›®æ ‡</text>
    </view>
    <view class="overview-item">
      <text class="overview-number">{{activeGoals}}</text>
      <text class="overview-label">è¿›è¡Œä¸­</text>
    </view>
    <view class="overview-item">
      <text class="overview-number">{{completedGoals}}</text>
      <text class="overview-label">å·²å®Œæˆ</text>
    </view>
    <view class="overview-item">
      <text class="overview-number">{{completionRate}}%</text>
      <text class="overview-label">å®Œæˆç‡</text>
    </view>
  </view>

  <!-- ç›®æ ‡åˆ—è¡¨ -->
  <view class="goals-list">
    <view class="list-header">
      <text class="list-title">æˆ‘çš„ç›®æ ‡</text>
    </view>

    <!-- ç›®æ ‡å¡ç‰‡åˆ—è¡¨ -->
    <view class="goal-cards" wx:if="{{goals.length > 0}}">
      <view class="goal-card {{item.status === 'ç»“æŸ' ? 'completed' : ''}}" 
            wx:for="{{goals}}" wx:key="id" bindtap="onGoalTap" data-id="{{item.id}}">
        
        <!-- ç›®æ ‡å¤´éƒ¨ -->
        <view class="goal-header">
          <view class="goal-category-badge">
            <text class="goal-category">{{item.categoryText}}</text>
          </view>
          <view class="goal-actions">
            <view class="action-btn-small {{item.status === 'ç»“æŸ' ? 'restore' : 'complete'}}" 
                  bindtap="toggleGoalComplete" data-id="{{item.id}}">
              <text class="action-icon-small">{{item.status === 'ç»“æŸ' ? 'â†»' : 'âœ“'}}</text>
            </view>
            <view class="action-btn-small delete" bindtap="deleteGoal" data-id="{{item.id}}">
              <text class="action-icon-small">ğŸ—‘</text>
            </view>
          </view>
        </view>

        <!-- ç›®æ ‡æ ‡é¢˜ -->
        <text class="goal-title">{{item.title}}</text>
        
        <!-- ç›®æ ‡æè¿° -->
        <text class="goal-description" wx:if="{{item.description}}">{{item.description}}</text>

        <!-- è¿›åº¦æ¡ -->
        <view class="goal-progress">
          <view class="progress-info">
            <text class="progress-text">è¿›åº¦</text>
            <text class="progress-detail">{{item.progressPercent}}%</text>
          </view>
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.progressPercent}}%"></view>
          </view>
        </view>

        <!-- ç›®æ ‡åº•éƒ¨ä¿¡æ¯ -->
        <view class="goal-footer">
          <view class="goal-dates">
            <text class="start-date">å¼€å§‹: {{item.startDateText}}</text>
            <text class="end-date">æˆªæ­¢: {{item.endDateText}}</text>
          </view>
          <view class="goal-status-info">
            <text class="days-left {{item.daysLeft < 7 ? 'urgent' : ''}}">å‰©ä½™{{item.daysLeft}}å¤©</text>
            <view class="status-indicator" style="background-color: {{item.status === 'ç»“æŸ' ? '#28a745' : (item.daysLeft < 7 ? '#ff4757' : '#00B4D8')}}"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ¯</text>
      <text class="empty-title">è¿˜æ²¡æœ‰ç›®æ ‡</text>
      <text class="empty-subtitle">åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªç›®æ ‡ï¼Œå¼€å§‹å®ç°æ¢¦æƒ³</text>
      <button class="create-first-btn" bindtap="showCreateModal">åˆ›å»ºç›®æ ‡</button>
    </view>
  </view>
</view>

<!-- åˆ›å»ºç›®æ ‡å¼¹çª— -->
<view class="create-modal" wx:if="{{showCreateModal}}">
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">è¯­éŸ³åˆ›å»ºç›®æ ‡</text>
      <view class="close-btn" bindtap="hideCreateModal">âœ•</view>
    </view>

    <!-- è¯­éŸ³åˆ›å»ºåŒºåŸŸ -->
    <view class="voice-section">
      <view class="{{voiceButtonClass}}"
            bindtouchstart="startVoiceRecord"
            bindtouchend="stopVoiceRecord">
        <view class="voice-icon">ğŸ¤</view>
        <text class="main-text">{{recordingText}}</text>
        <text class="sub-text">{{voiceHint}}</text>
      </view>
    </view>

    <!-- è¯­éŸ³æç¤º -->
    <view class="voice-tip">
      <text class="tip-text">æŒ‰ä½è¯´è¯ï¼Œæ¾å¼€ç»“æŸå½•éŸ³</text>
      <text class="tip-text">å½•éŸ³å®Œæˆåå°†è‡ªåŠ¨è·³è½¬åˆ°åˆ›å»ºé¡µé¢</text>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰è¯­éŸ³æç¤ºå¼¹çª— -->
  <voice-hint-modal
    show="{{showVoiceHintModal}}"
    title="{{voiceHintData.title}}"
    voice-text="{{voiceHintData.voiceText}}"
    suggestions="{{voiceHintData.suggestions}}"
    cancel-text="{{voiceHintData.cancelText}}"
    confirm-text="{{voiceHintData.confirmText}}"
    bind:close="onVoiceHintModalClose"
    bind:cancel="onVoiceHintModalCancel"
    bind:confirm="onVoiceHintModalConfirm">
  </voice-hint-modal>
</view>

<!-- ç­›é€‰å’Œæ’åºå¼¹çª— -->
<view class="filter-modal" wx:if="{{showFilterModal}}">
  <view class="filter-content">
    <view class="filter-header">
      <text class="filter-title">ç­›é€‰å’Œæ’åº</text>
      <view class="close-btn" bindtap="hideFilterModal">âœ•</view>
    </view>

    <!-- çŠ¶æ€ç­›é€‰ -->
    <view class="filter-section">
      <text class="filter-section-title">çŠ¶æ€ç­›é€‰</text>
      <view class="filter-options">
        <view class="filter-option {{filterStatus === 'all' ? 'active' : ''}}" 
              bindtap="onFilterChange" data-status="all">
          <text class="option-text">å…¨éƒ¨</text>
        </view>
        <view class="filter-option {{filterStatus === 'è¿›è¡Œä¸­' ? 'active' : ''}}" 
              bindtap="onFilterChange" data-status="è¿›è¡Œä¸­">
          <text class="option-text">è¿›è¡Œä¸­</text>
        </view>
        <view class="filter-option {{filterStatus === 'ç»“æŸ' ? 'active' : ''}}" 
              bindtap="onFilterChange" data-status="ç»“æŸ">
          <text class="option-text">å·²å®Œæˆ</text>
        </view>
      </view>
    </view>

    <!-- æ’åºæ–¹å¼ -->
    <view class="filter-section">
      <text class="filter-section-title">æ’åºæ–¹å¼</text>
      <view class="filter-options">
        <view class="filter-option {{sortBy === 'deadline' ? 'active' : ''}}" 
              bindtap="onSortChange" data-sort="deadline">
          <text class="option-text">æŒ‰æˆªæ­¢æ—¶é—´</text>
        </view>
        <view class="filter-option {{sortBy === 'progress' ? 'active' : ''}}" 
              bindtap="onSortChange" data-sort="progress">
          <text class="option-text">æŒ‰è¿›åº¦</text>
        </view>
        <view class="filter-option {{sortBy === 'created' ? 'active' : ''}}" 
              bindtap="onSortChange" data-sort="created">
          <text class="option-text">æŒ‰åˆ›å»ºæ—¶é—´</text>
        </view>
      </view>
    </view>
  </view>
</view>
