<!--pages/goal-detail/goal-detail.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="header">
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <text class="title">ç›®æ ‡è¯¦æƒ…</text>
    <view class="edit-btn" bindtap="toggleEditMode">
      <text class="edit-text">{{isEditing ? 'å®Œæˆ' : 'ç¼–è¾‘'}}</text>
    </view>
  </view>

  <!-- ç›®æ ‡åŸºæœ¬ä¿¡æ¯ -->
  <view class="goal-info">
    <view class="info-header">
      <text class="goal-title">{{isEditing ? 'ç¼–è¾‘ç›®æ ‡' : 'ç›®æ ‡ä¿¡æ¯'}}</text>
    </view>
    
    <!-- ç›®æ ‡æ ‡é¢˜ -->
    <view class="info-section">
      <text class="section-title">ç›®æ ‡æ ‡é¢˜</text>
      <input wx:if="{{isEditing}}" 
             class="title-input" 
             value="{{goalData.title}}" 
             bindinput="onTitleChange"
             placeholder="è¯·è¾“å…¥ç›®æ ‡æ ‡é¢˜" />
      <text wx:else class="info-text">{{goalData.title}}</text>
    </view>

    <!-- ç›®æ ‡åˆ†ç±» -->
    <view class="info-section">
      <text class="section-title">ç›®æ ‡åˆ†ç±»</text>
      <picker wx:if="{{isEditing}}" 
              mode="selector" 
              range="{{categories}}" 
              range-key="name" 
              value="{{categoryIndex}}" 
              bindchange="onCategoryChange">
        <view class="picker-display">
          <text class="picker-text">{{categories[categoryIndex].name}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
      <text wx:else class="info-text">{{goalData.category}}</text>
    </view>

    <!-- ç›®æ ‡æè¿° -->
    <view class="info-section">
      <text class="section-title">ç›®æ ‡æè¿°</text>
      <textarea wx:if="{{isEditing}}" 
                class="description-input" 
                value="{{goalData.description}}" 
                bindinput="onDescriptionChange"
                placeholder="è¯·è¾“å…¥ç›®æ ‡æè¿°"
                auto-height />
      <text wx:else class="info-text">{{goalData.description}}</text>
    </view>

    <!-- ç›®æ ‡çŠ¶æ€å’Œå‰©ä½™å¤©æ•° -->
    <view class="info-section" wx:if="{{!isEditing}}">
      <text class="section-title">ç›®æ ‡çŠ¶æ€</text>
      <view class="status-section">
        <view class="status-item">
          <text class="status-label">å½“å‰çŠ¶æ€</text>
          <text class="status-value {{statusClass}}">{{goalData.status || 'è¿›è¡Œä¸­'}}</text>
        </view>
        <view class="status-item" wx:if="{{goalData.remaining_days !== undefined}}">
          <text class="status-label">å‰©ä½™å¤©æ•°</text>
          <text class="status-value {{remainingDaysClass}}">
            {{goalData.remaining_days > 0 ? goalData.remaining_days + 'å¤©' : 'å·²è¿‡æœŸ'}}
          </text>
        </view>
      </view>
    </view>

    <!-- æ—¶é—´è®¾ç½® -->
    <view class="info-section">
      <text class="section-title">æ—¶é—´è®¾ç½®</text>
      <view class="time-inputs">
        <view class="time-input">
          <text class="time-label">å¼€å§‹æ—¶é—´</text>
          <picker wx:if="{{isEditing}}" 
                  mode="date" 
                  value="{{goalData.startDate}}" 
                  bindchange="onStartDateChange">
            <view class="picker-display">
              <text class="picker-text">{{goalData.startDate || 'è¯·é€‰æ‹©å¼€å§‹æ—¶é—´'}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
          <text wx:else class="info-text">{{goalData.startDate || 'æœªè®¾ç½®'}}</text>
        </view>
        
        <view class="time-input">
          <text class="time-label">ç»“æŸæ—¶é—´</text>
          <picker wx:if="{{isEditing}}" 
                  mode="date" 
                  value="{{goalData.endDate}}" 
                  bindchange="onEndDateChange">
            <view class="picker-display">
              <text class="picker-text">{{goalData.endDate || 'è¯·é€‰æ‹©ç»“æŸæ—¶é—´'}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </picker>
          <text wx:else class="info-text">{{goalData.endDate || 'æœªè®¾ç½®'}}</text>
        </view>
      </view>
    </view>

    <!-- é‡åŒ–æŒ‡æ ‡ -->
    <view class="info-section">
      <text class="section-title">é‡åŒ–æŒ‡æ ‡</text>
      <view class="quantification-inputs">
        <view class="quant-input">
          <text class="quant-label">ç›®æ ‡å€¼</text>
          <input wx:if="{{isEditing}}" 
                 class="value-input" 
                 value="{{goalData.targetValue}}" 
                 bindinput="onTargetValueChange"
                 placeholder="ç›®æ ‡å€¼" />
          <text wx:else class="info-text">{{goalData.targetValue || 'æœªè®¾ç½®'}}</text>
        </view>
        
        <view class="quant-input">
          <text class="quant-label">å½“å‰å€¼</text>
          <input wx:if="{{isEditing}}" 
                 class="value-input" 
                 value="{{goalData.currentValue}}" 
                 bindinput="onCurrentValueChange"
                 placeholder="å½“å‰å€¼" />
          <text wx:else class="info-text">{{goalData.currentValue || 'æœªè®¾ç½®'}}</text>
        </view>
        
        <view class="quant-input">
          <text class="quant-label">å•ä½</text>
          <input wx:if="{{isEditing}}" 
                 class="unit-input" 
                 value="{{goalData.unit}}" 
                 bindinput="onUnitChange"
                 placeholder="å•ä½" />
          <text wx:else class="info-text">{{goalData.unit || 'æœªè®¾ç½®'}}</text>
        </view>
      </view>
    </view>

    <!-- è¿›åº¦æ˜¾ç¤º -->
    <view class="info-section" wx:if="{{!isEditing && goalData.targetValue && goalData.currentValue}}">
      <text class="section-title">å½“å‰è¿›åº¦</text>
      <view class="progress-section">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{progressPercentage}}%"></view>
        </view>
        <text class="progress-text">{{progressPercentage}}%</text>
      </view>
    </view>

    <!-- ä¼˜å…ˆçº§ -->
    <view class="info-section">
      <text class="section-title">ä¼˜å…ˆçº§</text>
      <view wx:if="{{isEditing}}" class="priority-options">
        <view class="priority-item {{goalData.priority === 'high' ? 'selected' : ''}}" 
              bindtap="selectPriority" 
              data-priority="high">
          <text class="priority-icon">ğŸ”¥</text>
          <text class="priority-name">é«˜</text>
        </view>
        <view class="priority-item {{goalData.priority === 'medium' ? 'selected' : ''}}" 
              bindtap="selectPriority" 
              data-priority="medium">
          <text class="priority-icon">âš¡</text>
          <text class="priority-name">ä¸­</text>
        </view>
        <view class="priority-item {{goalData.priority === 'low' ? 'selected' : ''}}" 
              bindtap="selectPriority" 
              data-priority="low">
          <text class="priority-icon">ğŸŒ±</text>
          <text class="priority-name">ä½</text>
        </view>
      </view>
      <text wx:else class="info-text">
        <text wx:if="{{goalData.priority === 'high'}}">ğŸ”¥ é«˜</text>
        <text wx:elif="{{goalData.priority === 'medium'}}">âš¡ ä¸­</text>
        <text wx:elif="{{goalData.priority === 'low'}}">ğŸŒ± ä½</text>
        <text wx:else>æœªè®¾ç½®</text>
      </text>
    </view>

    <!-- æé†’è®¾ç½® -->
    <view class="info-section">
      <text class="section-title">æé†’è®¾ç½®</text>
      <view class="reminder-options">
        <view class="reminder-item">
          <text class="reminder-label">æ¯æ—¥æé†’</text>
          <switch wx:if="{{isEditing}}" 
                  checked="{{goalData.dailyReminder}}" 
                  bindchange="onDailyReminderChange" />
          <text wx:else class="info-text">{{goalData.dailyReminder ? 'å¼€å¯' : 'å…³é—­'}}</text>
        </view>
        
        <view class="reminder-item">
          <text class="reminder-label">æˆªæ­¢æé†’</text>
          <switch wx:if="{{isEditing}}" 
                  checked="{{goalData.deadlineReminder}}" 
                  bindchange="onDeadlineReminderChange" />
          <text wx:else class="info-text">{{goalData.deadlineReminder ? 'å¼€å¯' : 'å…³é—­'}}</text>
        </view>
      </view>
    </view>

    <!-- åˆ›å»ºæ—¶é—´ -->
    <view class="info-section">
      <text class="section-title">åˆ›å»ºæ—¶é—´</text>
      <text class="info-text">{{goalData.createdAt}}</text>
    </view>
  </view>

  <!-- ç¼–è¾‘æ¨¡å¼ä¸‹çš„ä¿å­˜æŒ‰é’® -->
  <view class="save-section" wx:if="{{isEditing}}">
    <button class="save-btn" bindtap="saveChanges">ä¿å­˜ä¿®æ”¹</button>
  </view>
</view>
