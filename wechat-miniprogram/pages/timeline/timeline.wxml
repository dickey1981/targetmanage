<!-- æ—¶é—´çº¿é¡µé¢ -->
<view class="container">
  <!-- é¡¶éƒ¨ç­›é€‰å™¨ -->
  <view class="filter-section">
    <view class="filter-tabs">
      <view class="filter-tab {{activeFilter === 'all' ? 'active' : ''}}"
            bindtap="setFilter"
            data-filter="all">
        <text>å…¨éƒ¨</text>
      </view>
      <view class="filter-tab {{activeFilter === 'progress' ? 'active' : ''}}"
            bindtap="setFilter"
            data-filter="progress">
        <text>è¿›åº¦</text>
      </view>
      <view class="filter-tab {{activeFilter === 'milestone' ? 'active' : ''}}"
            bindtap="setFilter"
            data-filter="milestone">
        <text>é‡Œç¨‹ç¢‘</text>
      </view>
      <view class="filter-tab {{activeFilter === 'difficulty' ? 'active' : ''}}"
            bindtap="setFilter"
            data-filter="difficulty">
        <text>å›°éš¾</text>
      </view>
    </view>
    
    <view class="time-range">
      <picker mode="selector" 
              range="{{timeRanges}}" 
              range-key="name"
              value="{{timeRangeIndex}}"
              bindchange="onTimeRangeChange">
        <view class="picker-text">
          <text>{{timeRanges[timeRangeIndex].name}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="stats-section" wx:if="{{stats}}">
    <view class="stats-card">
      <view class="stat-item">
        <text class="stat-number">{{stats.total_records}}</text>
        <text class="stat-label">æ€»è®°å½•</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.milestone_count}}</text>
        <text class="stat-label">é‡Œç¨‹ç¢‘</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.breakthrough_count}}</text>
        <text class="stat-label">çªç ´</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{Math.round(stats.positive_sentiment_ratio * 100)}}%</text>
        <text class="stat-label">ç§¯æç‡</text>
      </view>
    </view>
  </view>

  <!-- æ—¶é—´çº¿å†…å®¹ -->
  <view class="timeline-section">
    <view class="timeline-container" wx:if="{{timelineData.length > 0}}">
      <view class="timeline-item" 
            wx:for="{{timelineData}}" 
            wx:key="date">
        
        <!-- æ—¥æœŸæ ‡é¢˜ -->
        <view class="date-header">
          <view class="date-line"></view>
          <view class="date-badge">
            <text class="date-text">{{item.date}}</text>
            <text class="date-count">{{item.records.length}}æ¡è®°å½•</text>
          </view>
          <view class="date-line"></view>
        </view>
        
        <!-- å½“æ—¥è®°å½•åˆ—è¡¨ -->
        <view class="records-container">
          <view class="record-card {{record.record_type}} {{record.is_important ? 'important' : ''}} {{record.is_milestone ? 'milestone' : ''}} {{record.is_breakthrough ? 'breakthrough' : ''}}"
                wx:for="{{item.records}}" 
                wx:key="id"
                bindtap="viewRecordDetail"
                data-record="{{record}}">
            
            <!-- è®°å½•å¤´éƒ¨ -->
            <view class="record-header">
              <view class="record-type-badge {{record.record_type}}">
                <text class="type-icon">{{getTypeIcon(record.record_type)}}</text>
                <text class="type-name">{{getTypeName(record.record_type)}}</text>
              </view>
              <view class="record-time">
                <text>{{formatTime(record.recorded_at)}}</text>
              </view>
            </view>
            
            <!-- è®°å½•å†…å®¹ -->
            <view class="record-content">
              <text class="content-text">{{record.content}}</text>
            </view>
            
            <!-- è®°å½•æ ‡ç­¾ -->
            <view class="record-tags" wx:if="{{record.tags && record.tags.length > 0}}">
              <text class="tag" wx:for="{{record.tags}}" wx:key="*this">{{item}}</text>
            </view>
            
            <!-- è®°å½•çŠ¶æ€ -->
            <view class="record-status">
              <view class="status-item" wx:if="{{record.sentiment}}">
                <text class="status-icon {{record.sentiment}}">{{getSentimentIcon(record.sentiment)}}</text>
                <text class="status-text">{{getSentimentText(record.sentiment)}}</text>
              </view>
              <view class="status-item" wx:if="{{record.energy_level}}">
                <text class="status-icon">âš¡</text>
                <text class="status-text">ç²¾åŠ›{{record.energy_level}}/10</text>
              </view>
              <view class="status-item" wx:if="{{record.difficulty_level}}">
                <text class="status-icon">ğŸ’ª</text>
                <text class="status-text">éš¾åº¦{{record.difficulty_level}}/10</text>
              </view>
            </view>
            
            <!-- é‡è¦æ ‡è®° -->
            <view class="record-marks" wx:if="{{record.is_important || record.is_milestone || record.is_breakthrough}}">
              <text class="mark" wx:if="{{record.is_important}}">â­ é‡è¦</text>
              <text class="mark" wx:if="{{record.is_milestone}}">ğŸ† é‡Œç¨‹ç¢‘</text>
              <text class="mark" wx:if="{{record.is_breakthrough}}">ğŸ’¡ çªç ´</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">æš‚æ— è®°å½•</text>
      <text class="empty-hint">å¼€å§‹è®°å½•ä½ çš„æˆé•¿è¿‡ç¨‹å§</text>
      <button class="empty-btn" bindtap="goToRecord">å»è®°å½•</button>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && timelineData.length > 0}}">
    <button class="load-more-btn" bindtap="loadMore" loading="{{loading}}">
      {{loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}
    </button>
  </view>
</view>