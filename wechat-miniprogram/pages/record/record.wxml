<!--pages/record/record.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜ -->
  <view class="header">
    <text class="title">è¿‡ç¨‹è®°å½•</text>
    <text class="subtitle">è®°å½•æ‚¨çš„ç›®æ ‡å®ç°è¿‡ç¨‹</text>
  </view>

  <!-- è®°å½•ç±»å‹é€‰æ‹© -->
  <view class="record-types">
    <view 
      wx:for="{{recordTypes}}" 
      wx:key="id"
      class="record-type-item"
      data-id="{{item.id}}"
      bindtap="onSelectRecordType"
    >
      <view class="type-icon" style="background-color: {{item.color}}">
        {{item.icon}}
      </view>
      <text class="type-name">{{item.name}}</text>
    </view>
  </view>

  <!-- æœ€è¿‘è®°å½• -->
  <view class="recent-records" wx:if="{{isLoggedIn && recentRecords.length > 0}}">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘è®°å½•</text>
      <text class="section-more">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>
    <view class="records-list">
      <view 
        wx:for="{{recentRecords}}" 
        wx:key="id"
        class="record-item"
        data-record-id="{{item.id}}"
        bindtap="viewRecordDetail"
      >
        <view class="record-icon">
          <text class="icon">{{item.type === 'voice' ? 'ğŸ¤' : item.type === 'photo' ? 'ğŸ“·' : item.type === 'text' ? 'âœï¸' : 'ğŸ“'}}</text>
        </view>
        <view class="record-content">
          <text class="record-text">{{item.content}}</text>
          <text class="record-time">{{item.created_at}}</text>
        </view>
        <view class="record-arrow">></view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{isLoggedIn && recentRecords.length === 0}}">
    <text class="empty-text">è¿˜æ²¡æœ‰è®°å½•</text>
    <text class="empty-hint">é€‰æ‹©ä¸Šæ–¹è®°å½•ç±»å‹å¼€å§‹è®°å½•</text>
  </view>

  <!-- æœªç™»å½•æç¤º -->
  <view class="login-tip" wx:if="{{!isLoggedIn}}">
    <text class="tip-text">è¯·å…ˆç™»å½•åä½¿ç”¨è®°å½•åŠŸèƒ½</text>
  </view>

  <!-- è®°å½•æ¨¡æ€æ¡† -->
  <view class="record-modal {{showRecordModal ? 'show' : ''}}" wx:if="{{showRecordModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">
          {{currentRecordType === 'voice' ? 'è¯­éŸ³è®°å½•' : 
            currentRecordType === 'photo' ? 'æ‹ç…§è®°å½•' : 
            currentRecordType === 'text' ? 'æ–‡å­—è®°å½•' : 'è®°å½•'}}
        </text>
        <text class="modal-close" bindtap="closeRecordModal">Ã—</text>
      </view>
      
      <view class="modal-body">
        <!-- è¯­éŸ³è®°å½• -->
        <view wx:if="{{currentRecordType === 'voice'}}" class="voice-record">
          <view class="voice-container">
            <view class="voice-circle-wrapper">
              <view 
                class="voice-circle {{isRecording ? 'recording' : ''}}"
                bindtouchstart="startVoiceRecord"
                bindtouchend="stopVoiceRecord"
              >
                <view class="microphone-icon">ğŸ¤</view>
              </view>
              <!-- å½•éŸ³åŠ¨ç”»æ³¢çº¹ -->
              <view class="wave-animation" wx:if="{{isRecording}}">
                <view class="wave"></view>
                <view class="wave"></view>
                <view class="wave"></view>
              </view>
            </view>
            
            <view class="voice-status">
              <text class="status-text">{{recordingText}}</text>
              <text class="hint-text">{{voiceHint}}</text>
            </view>
          </view>
        </view>

        <!-- æ‹ç…§è®°å½• -->
        <view wx:if="{{currentRecordType === 'photo'}}" class="photo-record">
          <button class="photo-btn" bindtap="takePhoto">
            <text class="photo-icon">ğŸ“·</text>
            <text class="photo-text">ç‚¹å‡»æ‹ç…§</text>
          </button>
        </view>

        <!-- æ–‡å­—è®°å½• -->
        <view wx:if="{{currentRecordType === 'text'}}" class="text-record">
          <!-- ç›®æ ‡é€‰æ‹© -->
          <view class="goal-selection">
            <text class="goal-selection-title">é€‰æ‹©å…³è”ç›®æ ‡ï¼ˆå¯é€‰ï¼‰</text>
            <view class="goal-list">
              <view 
                wx:for="{{availableGoals}}" 
                wx:key="id"
                class="goal-item {{selectedGoalId === item.id ? 'selected' : ''}}"
                bindtap="selectGoal"
                data-goal-id="{{item.id}}"
              >
                <text class="goal-title">{{item.title}}</text>
                <text class="goal-progress">{{item.progress_percentage}}%</text>
              </view>
              <view 
                class="goal-item {{selectedGoalId === null ? 'selected' : ''}}"
                bindtap="clearGoalSelection"
              >
                <text class="goal-title">ä¸å…³è”ç›®æ ‡</text>
              </view>
            </view>
          </view>
          
          <textarea 
            class="text-input" 
            placeholder="è¯·è¾“å…¥è®°å½•å†…å®¹..."
            value="{{textInput}}"
            bindinput="onTextInput"
            maxlength="500"
          ></textarea>
          <view class="text-actions">
            <text class="text-hint">æœ€å¤š500å­—</text>
            <button 
              class="submit-btn {{isSubmitting ? 'submitting' : ''}}" 
              bindtap="submitTextRecord"
              disabled="{{isSubmitting}}"
            >
              {{isSubmitting ? 'æäº¤ä¸­...' : 'æäº¤è®°å½•'}}
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
