<!-- è¿‡ç¨‹è®°å½•é¡µé¢ -->
<view class="container {{recordContent ? 'has-sticky-bar' : ''}}">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="header">
    <text class="page-title">{{isEditMode ? 'ç¼–è¾‘è®°å½•' : 'è¿‡ç¨‹è®°å½•'}}</text>
    <view class="header-actions">
      <view class="voice-btn" bindtap="startVoiceRecord" wx:if="{{!isEditMode && !recordContent}}">
        <text class="voice-icon">ğŸ¤</text>
      </view>
    </view>
  </view>

  <!-- å›ºå®šæ“ä½œæ  -->
  <view class="sticky-action-bar" wx:if="{{recordContent}}">
    <text class="action-title">{{isEditMode ? 'ç¼–è¾‘è®°å½•' : 'ç¡®è®¤è®°å½•'}}</text>
    <view class="save-btn" bindtap="saveRecord">ä¿å­˜</view>
  </view>

  <!-- è¯­éŸ³è®°å½•åŒºåŸŸ -->
  <view class="voice-section" wx:if="{{showVoiceSection}}">
    <!-- æµ‹è¯•æŒ‰é’® -->
    <view class="test-button" bindtap="testButton">
      <text>æµ‹è¯•æŒ‰é’®</text>
    </view>
    
    <view class="voice-container">
      <view class="voice-button {{isRecording ? 'recording' : ''}}" 
            bindtouchstart="startRecording" 
            bindtouchend="stopRecording">
        <text class="voice-text">{{recordingText}}</text>
        <text class="voice-hint">{{voiceHint}}</text>
        <view class="recording-indicator" wx:if="{{isRecording}}">
          <view class="pulse-dot"></view>
          <view class="pulse-dot"></view>
          <view class="pulse-dot"></view>
        </view>
      </view>
    </view>
    
    <!-- è¯­éŸ³æç¤º -->
    <view class="voice-tip">
      <text class="tip-text">æŒ‰ä½è¯´è¯ï¼Œæ¾å¼€ç»“æŸå½•éŸ³</text>
      <text class="tip-text">ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†æè®°å½•ç±»å‹å’Œæƒ…æ„Ÿ</text>
    </view>
  </view>

  <!-- è®°å½•å†…å®¹ç¼–è¾‘ -->
  <view class="content-section" wx:if="{{showContentSection}}">
    <text class="section-title">è®°å½•å†…å®¹</text>
    <textarea class="content-input" 
              placeholder="è¯·è¾“å…¥è®°å½•å†…å®¹..."
              value="{{recordContent}}"
              bindinput="onContentInput"
              maxlength="100"
              show-confirm-bar="{{false}}">
    </textarea>
    <view class="char-count">{{recordContent.length}}/100</view>
  </view>

  <!-- æ‰€å±ç›®æ ‡é€‰æ‹© -->
  <view class="goal-section" wx:if="{{showGoalSection}}">
    <text class="section-title">æ‰€å±ç›®æ ‡</text>
    
    <!-- ä¸‹æ‹‰é€‰æ‹©æ¡† -->
    <view class="dropdown-container">
      <!-- é€‰æ‹©æ¡†æ˜¾ç¤ºåŒºåŸŸ -->
      <view class="dropdown-display" bindtap="toggleGoalDropdown">
        <view class="selected-goal">
          <text class="goal-title">{{selectedGoalTitle || 'è¯·é€‰æ‹©ç›®æ ‡'}}</text>
          <text class="goal-category" wx:if="{{selectedGoalCategory}}">{{selectedGoalCategory}}</text>
        </view>
        <view class="dropdown-arrow {{isGoalDropdownOpen ? 'open' : ''}}">â–¼</view>
      </view>
      
      <!-- ä¸‹æ‹‰é€‰é¡¹åŒºåŸŸ -->
      <view class="dropdown-options" wx:if="{{isGoalDropdownOpen}}">
        <!-- æœç´¢æ¡† -->
        <view class="search-container">
          <input class="search-input" 
                 placeholder="æœç´¢ç›®æ ‡..." 
                 value="{{goalSearchText}}"
                 bindinput="onGoalSearchInput"
                 confirm-type="search" />
        </view>
        
        <!-- é€‰é¡¹åˆ—è¡¨ -->
        <view class="options-list">
          <!-- æ— ç›®æ ‡é€‰é¡¹ -->
          <view class="option-item {{selectedGoalId === null ? 'selected' : ''}}"
                bindtap="selectGoal"
                data-id="{{null}}">
            <view class="option-info">
              <text class="option-title">æ— ç›®æ ‡</text>
              <text class="option-category">ç‹¬ç«‹è®°å½•</text>
            </view>
            <view class="option-check" wx:if="{{selectedGoalId === null}}">âœ“</view>
          </view>
          
          <!-- è¿‡æ»¤åçš„ç›®æ ‡é€‰é¡¹ -->
          <view class="option-item {{selectedGoalId === item.id ? 'selected' : ''}}"
                wx:for="{{filteredGoals}}" 
                wx:key="id"
                bindtap="selectGoal"
                data-id="{{item.id}}">
            <view class="option-info">
              <text class="option-title">{{item.title}}</text>
              <text class="option-category" wx:if="{{item.category}}">{{item.category}}</text>
            </view>
            <view class="option-check" wx:if="{{selectedGoalId === item.id}}">âœ“</view>
          </view>
          
          <!-- æ— åŒ¹é…ç»“æœ -->
          <view class="no-results" wx:if="{{filteredGoals.length === 0 && goalSearchText}}">
            <text>æœªæ‰¾åˆ°åŒ¹é…çš„ç›®æ ‡</text>
          </view>
          
          <!-- æš‚æ— ç›®æ ‡ -->
          <view class="no-goals" wx:if="{{availableGoals.length === 0 && !goalSearchText}}">
            <text>æš‚æ— å¯ç”¨ç›®æ ‡</text>
            <text style="display: block; margin-top: 10rpx; font-size: 24rpx;">æ‚¨å¯ä»¥å…ˆåˆ›å»ºç›®æ ‡</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è®°å½•ç±»å‹é€‰æ‹© -->
  <view class="type-section" wx:if="{{showTypeSection}}">
    <text class="section-title">é€‰æ‹©è®°å½•ç±»å‹</text>
    <view class="type-grid">
      <view class="type-item {{selectedType === item.value ? 'selected' : ''}}"
            wx:for="{{recordTypes}}" 
            wx:key="value"
            bindtap="selectRecordType"
            data-type="{{item.value}}">
        <text class="type-icon">{{item.icon}}</text>
        <text class="type-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- é‡è¦æ ‡è®° -->
  <view class="mark-section" wx:if="{{showMarkSection}}">
    <text class="section-title">é‡è¦æ ‡è®°</text>
    <view class="mark-options">
      <view class="mark-item {{isImportant ? 'selected' : ''}}"
            bindtap="toggleImportant">
        <text class="mark-icon">â­</text>
        <text class="mark-name">é‡è¦</text>
      </view>
      <view class="mark-item {{isMilestone ? 'selected' : ''}}"
            bindtap="toggleMilestone">
        <text class="mark-icon">ğŸ†</text>
        <text class="mark-name">é‡Œç¨‹ç¢‘</text>
      </view>
      <view class="mark-item {{isBreakthrough ? 'selected' : ''}}"
            bindtap="toggleBreakthrough">
        <text class="mark-icon">ğŸ’¡</text>
        <text class="mark-name">çªç ´</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾ç¼–è¾‘ -->
  <view class="tags-section" wx:if="{{showMarkSection}}">
    <text class="section-title">æ ‡ç­¾</text>
    
    <!-- ç°æœ‰æ ‡ç­¾ -->
    <view class="tags-container" wx:if="{{tags.length > 0}}">
      <view class="tag-item" wx:for="{{tags}}" wx:key="*this">
        <text class="tag-text">{{item}}</text>
        <text class="tag-remove" bindtap="removeTag" data-index="{{index}}">Ã—</text>
      </view>
    </view>
    
    <!-- æ·»åŠ æ–°æ ‡ç­¾ -->
    <view class="add-tag-container">
      <input class="tag-input" 
             placeholder="è¾“å…¥æ–°æ ‡ç­¾ï¼ŒæŒ‰å›è½¦æ·»åŠ " 
             value="{{newTag}}"
             bindinput="onTagInput"
             confirm-type="done"
             bindconfirm="addTag" />
    </view>
  </view>

  <!-- åˆ†æç»“æœå±•ç¤º -->
  <view class="analysis-section" wx:if="{{showAnalysisSection && analysisResult}}">
    <text class="section-title">æ™ºèƒ½åˆ†æç»“æœ</text>
    <view class="analysis-card">
      <view class="analysis-item">
        <text class="analysis-label">è®°å½•ç±»å‹:</text>
        <text class="analysis-value">{{analysisResult.record_type}}</text>
      </view>
      <view class="analysis-item">
        <text class="analysis-label">æƒ…æ„Ÿå€¾å‘:</text>
        <text class="analysis-value {{analysisResult.sentiment}}">{{analysisResult.sentiment}}</text>
      </view>
      <view class="analysis-item">
        <text class="analysis-label">å…³é”®è¯:</text>
        <text class="analysis-value">{{analysisResult.keywords.join(', ')}}</text>
      </view>
      <view class="analysis-item">
        <text class="analysis-label">ç½®ä¿¡åº¦:</text>
        <text class="analysis-value">{{analysisResult.confidence_score}}%</text>
      </view>
    </view>
  </view>


</view>